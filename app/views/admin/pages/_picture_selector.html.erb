<% if !@pictures.nil? and !@pictures.empty? %>
<%= stylesheet_link_tag "picture_selector.css" %>
<%= javascript_include_tag "jquery.galleriffic.js" %>
<%= javascript_include_tag "jquery.history.js" %>
<%= javascript_include_tag "jquery.opacityrollover.js" %>
<div id="show_hide_picture_selector">Show/Hide Picture Selector</div>

<div id="picture_selector">
	<div id="thumbs" class="navigation">
		<ul class="thumbs noscript">
			<% for picture in @pictures %>
				<li>
					<a class="thumb" href="<%= image_path(picture.image_path) %>" title="<%= picture.title %>">
						<%= image_tag(picture.thumbnail_path, :alt => picture.alt_text, :width => 50) %>
					</a>
					<div class="caption">
						<div class="image-title">Title: <%= picture.title %></div>
						<div class="image-desc">Caption: <%= picture.caption %></div>
						<div class="download">
							<%= link_to "Insert Image", "#",
							:class => "button",
							:onclick => "$('#page_body').insertImageTagAtCaret('#{image_path(picture.image_path)}','#{picture.alt_text}',false); return false;" %>
							<%= link_to "Insert Image as Link", "#",
							:class => "button",
							:onclick => "$('#page_body').insertImageTagAtCaret('#{image_path(picture.image_path)}','',true); return false;" %>
						</div>
					</div>
				</li>
			<% end %>
		</ul>
	</div>
	<div id="gallery" class="content">
		<div id="controls" class="controls"></div>
		<div class="slideshow-container">
			<div id="loading" class="loader"></div>
			<div id="slideshow" class="slideshow"></div>
		</div>
		<div id="caption" class="caption-container"></div>
	</div>
	<div style="clear: both;"></div>
	<script type="text/javascript">
		$(document).ready(function() {
			$("#show_hide_picture_selector").css({ "cursor":"s-resize" });

			$("#show_hide_picture_selector").click(
				function () {
					// Toggle the Content Box
					$("#picture_selector").slideToggle("slow");
				}
			);


			var onMouseOutOpacity = 0.67;
			$('#thumbs ul.thumbs li, div.navigation a.pageLink').opacityrollover({
				mouseOutOpacity:   onMouseOutOpacity,
				mouseOverOpacity:  1.0,
				fadeSpeed:         'fast',
				exemptionSelector: '.selected'
			});


			// Initialize Minimal Galleriffic Gallery
			gallery = $('#thumbs').galleriffic({
				delay:                     2500,
				numThumbs:                 10,
				preloadAhead:              10,
				enableKeyboardNavigation:  false,
				imageContainerSel:         '#slideshow',
				controlsContainerSel:      '#controls',
				captionContainerSel:       '#caption',
				loadingContainerSel:       '#loading',
				renderSSControls:          false,//true,
				renderNavControls:         true,
				playLinkText:              'Play Slideshow',
				pauseLinkText:             'Pause Slideshow',
				prevLinkText:              '&lsaquo; Previous Photo',
				nextLinkText:              'Next Photo &rsaquo;',
				nextPageLinkText:          'Next Page &rsaquo;',
				prevPageLinkText:          '&lsaquo; Previous Page',
				enableHistory:             true,
				autoStart:                 false,
				defaultTransitionDuration: 900,
				onSlideChange:             function(prevIndex, nextIndex) {
					// 'this' refers to the gallery, which is an extension of $('#thumbs')
					this.find('ul.thumbs').children()
						.eq(prevIndex).fadeTo('fast', onMouseOutOpacity).end()
						.eq(nextIndex).fadeTo('fast', 1.0);
				},
				onPageTransitionOut:       function(callback) {
					this.fadeTo('fast', 0.0, callback);
				},
				onPageTransitionIn:        function() {
					this.fadeTo('fast', 1.0);
				}
			});

			/****************************************************************************************/

			/**** Functions to support integration of galleriffic with the jquery.history plugin ****/

			// PageLoad function
			// This function is called when:
			// 1. after calling $.historyInit();
			// 2. after calling $.historyLoad();
			// 3. after pushing "Go Back" button of a browser
			function pageload(hash) {
				// alert("pageload: " + hash);
				// hash doesn't contain the first # character.
				if(hash) {
					$.galleriffic.gotoImage(hash);
				} else {
					gallery.gotoIndex(0);
				}
			}

			// Initialize history plugin.
			// The callback is called at once by present location.hash.
			$.historyInit(pageload, "advanced.html");

			// set onlick event for buttons using the jQuery 1.3 live method
			$("a[rel='history']").live('click', function(e) {
				if (e.button != 0) return true;

				var hash = this.href;
				hash = hash.replace(/^.*#/, '');

				// moves to a new page.
				// pageload is called at once.
				// hash don't contain "#", "?"
				$.historyLoad(hash);

				return false;
			});

			/****************************************************************************************/

			$("#picture_selector").toggle();
		});
	</script>
</div>
<% end %>
